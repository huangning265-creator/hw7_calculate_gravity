<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gravity Station â€” Web Interface</title>
  <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
  <main class="container">
    <h1>åœ°çƒç‰©ç†é‡åŠ›è¨ˆç®—å·¥ä½œç«™ v2.0</h1>
    <p class="muted">è¼¸å…¥æ¸¬ç«™è³‡æ–™ï¼ŒæŒ‰ä¸‹ã€Œç”¢ç”Ÿå°ˆæ¥­å ±å‘Šã€ã€‚ï¼ˆå¾Œç«¯ç”± Flask æä¾›è¨ˆç®—ï¼‰</p>

    <section class="form-card">
      <form id="gravityForm">
        <div class="row">
          <label>æ¸¬ç«™é¡å‹</label>
          <select name="station_type" id="station_type">
            <option value="Land" selected>Land</option>
            <option value="Marine">Marine</option>
          </select>
        </div>

        <div class="row">
          <label for="g_obs">è§€æ¸¬é‡åŠ› g_obs (mGal)</label>
          <input type="number" step="any" id="g_obs" name="g_obs" value="980717.39" required />
        </div>

        <div class="row">
          <label for="lat">ç·¯åº¦ (degree)</label>
          <input type="number" step="any" id="lat" name="lat" value="48.1195" required />
        </div>

        <div class="row">
          <label for="lon">ç¶“åº¦ (degree)</label>
          <input type="number" step="any" id="lon" name="lon" value="12.1878" required />
        </div>

        <div class="row">
          <label for="h">é«˜ç¨‹ / æ°´æ·± h (m)</label>
          <input type="number" step="any" id="h" name="h" value="487.9" required />
        </div>

        <details class="row" style="margin-top:8px;">
          <summary>é€²éšé¸é … (å¯†åº¦)</summary>
          <label for="rho_rock">åœ°æ®¼å²©çŸ³å¯†åº¦ Ï_rock (g/cmÂ³)</label>
          <input type="range" id="rho_rock" name="rho_rock" min="1.0" max="3.5" step="0.01" value="2.67" />
          <span id="rho_val">2.67</span>
        </details>

        <div class="row">
          <button type="submit" id="submitBtn">ğŸš€ ç”¢ç”Ÿå°ˆæ¥­å ±å‘Š</button>
        </div>
      </form>
    </section>

    <section class="result-card">
      <h2>è¨ˆç®—å ±å‘Š</h2>
      <pre id="reportBox" class="report-box">çµæœæœƒé¡¯ç¤ºåœ¨é€™è£¡...</pre>
    </section>
  </main>

  <script>
    // ç¯„ä¾‹å‰ç«¯è¡Œç‚ºï¼šé€é fetch å°‡ JSON å‚³åˆ°å¾Œç«¯ /calculate
    const form = document.getElementById('gravityForm');
    const reportBox = document.getElementById('reportBox');
    const rho = document.getElementById('rho_rock');
    const rhoVal = document.getElementById('rho_val');

    rho.addEventListener('input', (e) => {
      rhoVal.textContent = e.target.value;
    });

    form.addEventListener('submit', async (ev) => {
      ev.preventDefault();
      reportBox.textContent = "è¨ˆç®—ä¸­ï¼Œè«‹ç¨å€™â€¦";

      const payload = {
        station_type: document.getElementById('station_type').value,
        g_obs: document.getElementById('g_obs').value,
        lat: document.getElementById('lat').value,
        lon: document.getElementById('lon').value,
        h: document.getElementById('h').value,
        rho_rock: document.getElementById('rho_rock').value
      };

      try {
        const resp = await fetch('/calculate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!resp.ok) {
          const err = await resp.json();
          reportBox.textContent = "ä¼ºæœå™¨å›å‚³éŒ¯èª¤ï¼š " + (err.message || JSON.stringify(err));
          return;
        }

        const data = await resp.json();
        reportBox.textContent = data.report;
      } catch (e) {
        reportBox.textContent = "ç„¡æ³•é€£ç·šè‡³å¾Œç«¯ï¼Œè«‹ç¢ºèªä¼ºæœå™¨æ˜¯å¦å•Ÿå‹•ã€‚\néŒ¯èª¤ï¼š" + e;
      }
    });
  </script>
</body>
</html>
